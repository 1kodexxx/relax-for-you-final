---
import "@/styles/promo-banner.css";
---

<section id="promo-banner" class="promo-banner" hidden>
  <div class="promo-banner__panel">
    <button class="promo-banner__close" type="button" aria-label="Закрыть">×</button>

    <div class="promo-banner__image">
      <img src="/banner.jpg" alt="Relax GOLD" loading="lazy" decoding="async" />
    </div>

    <header class="promo-banner__header">
      <p class="promo-banner__eyebrow">🔥 Специальное предложение</p>
      <h2 class="promo-banner__title_text">
        Для <span>НАШИХ</span> клиентов <span>СЕЙЧАС</span> действует акция ✅✅✅
      </h2>
    </header>

    <ul class="promo-banner__list">
      <li>
        🔥 <b>Body EROTIC</b> по будням с 12:00–16:00 → <span class="price-banner">5000 ₽</span>
      </li>
      <li>💎 <b>Скидка 50%</b> на VIP в День Рождения</li>
      <li>🎁 Приведи 3 друзей — получи МАССАЖ в подарок</li>
    </ul>

    <div class="promo-banner__actions">
      <a href="#booking" class="promo-banner__btn" data-booking-trigger>ЗАПИСАТЬСЯ СЕЙЧАС</a>
    </div>
  </div>
</section>

<script is:inline>
  (() => {
    const banner = document.querySelector("#promo-banner");
    const closeBtn = banner?.querySelector(".promo-banner__close");
    const gallery = document.querySelector("#gallery"); // 🎯 Блок, после которого появляем баннер

    if (!banner || !gallery) return;

    // 🔮 Функция показа баннера
    const showBanner = () => {
      banner.hidden = false;
      banner.classList.add("visible");
    };

    // 👀 Отслеживаем появление конца галереи в зоне видимости
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            showBanner();
            observer.disconnect(); // один раз
          }
        });
      },
      {
        root: null,
        rootMargin: "0px 0px -10% 0px", // появляется чуть раньше конца
        threshold: 0.1,
      }
    );

    // 📍 Добавим “якорь” в конец галереи, если его нет
    let endMarker = gallery.querySelector("[data-gallery-end]");
    if (!endMarker) {
      endMarker = document.createElement("div");
      endMarker.setAttribute("data-gallery-end", "");
      endMarker.style.cssText = "width:100%;height:1px;";
      gallery.appendChild(endMarker);
    }

    observer.observe(endMarker);

    // ❌ Закрытие баннера
    closeBtn?.addEventListener("click", () => {
      banner.classList.add("closing");
      setTimeout(() => banner.remove(), 300);
    });
  })();
</script>
